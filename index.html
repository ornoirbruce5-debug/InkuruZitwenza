<!DOCTYPE html>
<html lang="rw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeune Boutique ‚Äî Digital Dropshipping Media Boutique</title>
  <meta name="description" content="Supermarket Chatbot Assistant with warmth and memory. Ibicuruzwa byiza, kugiciro gito." />

  <!-- Inline CSS -->
  <style>
    :root {
      --bg: #0e0f14;
      --fg: #f7f7f7;
      --card: #171821;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --muted: #a1a1aa;
      --danger: #ef4444;
      --success: #22c55e;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --space: clamp(0.8rem, 2vw, 1.2rem);
      --font-size: clamp(16px, 1.6vw, 18px);
      --title-size: clamp(28px, 5vw, 46px);
      --subtitle-size: clamp(16px, 2.5vw, 20px);
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Fira Sans", "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      font-size: var(--font-size);
      line-height: 1.4;
      color: #1f2937;
      background: #fff;
    }

    body.theme-dark { background: var(--bg); color: var(--fg); }
    .site-header {
      position: sticky; top: 0; backdrop-filter: saturate(1.2) blur(8px);
      background: rgba(255,255,255,0.75);
      border-bottom: 1px solid #e5e7eb; z-index: 20;
    }
    body.theme-dark .site-header { background: rgba(14,15,20,0.65); border-color: #262739; }
    .nav { display: flex; align-items: center; gap: var(--space); padding: var(--space); }
    .brand { font-weight: 700; letter-spacing: 0.4px; text-decoration: none; color: inherit; }
    .nav-link { text-decoration: none; color: inherit; opacity: 0.8; }
    .nav-link:hover { opacity: 1; }

    .btn-primary, .btn-secondary {
      padding: 0.6rem 1rem; border-radius: var(--radius);
      border: none; cursor: pointer; transition: transform 180ms ease, opacity 180ms ease;
    }
    .btn-primary { background: var(--accent); color: #0b1020; font-weight: 700; }
    .btn-secondary { background: var(--accent-2); color: #0b1020; font-weight: 600; }
    .btn-primary:hover, .btn-secondary:hover { transform: translateY(-1px); }

    .hero { position: relative; min-height: 70vh; display: grid; place-items: center; }
    .bg-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; filter: saturate(1.15) contrast(1.05); }
    .hero-content {
      position: relative; z-index: 2; padding: 2rem; text-align: center;
      backdrop-filter: blur(3px); color: #fff;
    }
    .title { font-size: var(--title-size); margin: 0 0 0.5rem; }
    .subtitle { font-size: var(--subtitle-size); margin: 0 0 1rem; opacity: 0.9; }
    .audio-player { margin: 1rem auto; }
    .hero-cta { margin-top: 1rem; }

    .daily, .stock, .feedback, .chatbot, .map, .contact {
      padding: clamp(1rem, 4vw, 3rem);
    }

    .stock-controls {
      display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.8rem;
    }
    .stock-table { width: 100%; border-collapse: collapse; }
    .stock-table th, .stock-table td {
      padding: 0.6rem; border-bottom: 1px solid #e5e7eb; vertical-align: middle;
    }
    .stock-table img { width: 64px; height: 64px; object-fit: cover; border-radius: 8px; }

    .feedback .testimonials {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: var(--space);
    }
    .card {
      background: #fff; border: 1px solid #e5e7eb; border-radius: var(--radius);
      box-shadow: var(--shadow); padding: 1rem;
    }
    body.theme-dark .card { background: var(--card); border-color: #2b2d3b; }

    .chatbot .chat-top { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.8rem; }
    .chat-window {
      display: grid; grid-template-columns: 1fr 120px; gap: 0.8rem; align-items: start;
    }
    .messages {
      background: #fff; border: 1px solid #e5e7eb; border-radius: var(--radius);
      padding: 0.8rem; min-height: 200px; max-height: 360px; overflow: auto;
    }
    body.theme-dark .messages { background: var(--card); border-color: #2b2d3b; }
    .assistant-photo {
      width: 120px; height: 120px; border-radius: 12px;
      background: #d1d5db;
      display: grid; place-items: center; color: #0b1020; font-weight: 700;
    }
    .chat-input { display: flex; gap: 0.5rem; margin-top: 0.8rem; }

    .map-embed iframe {
      width: 100%; min-height: 320px; border: 0; border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .contact form {
      display: grid; gap: 0.6rem; max-width: 560px;
    }
    .contact input, .contact textarea, .chatbot input, .chatbot select {
      padding: 0.6rem; border-radius: 10px; border: 1px solid #cbd5e1;
      background: #fff; color: inherit;
    }
    body.theme-dark .contact input, body.theme-dark .contact textarea, body.theme-dark .chatbot input, body.theme-dark .chatbot select {
      background: #10121a; border-color: #303245; color: var(--fg);
    }

    .site-footer {
      border-top: 1px solid #e5e7eb; padding: var(--space);
    }
    .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: var(--space); }
    .socials a { margin-right: 0.6rem; }

    .qr { width: 128px; height: 128px; border-radius: 10px; }

    .fade-in {
      animation: fadeInUp 500ms ease both;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Message bubbles */
    .msg { padding: 0.5rem 0.7rem; border-radius: 10px; margin: 0.35rem 0; }
    .msg.user { background: #e5e7eb; color: #111827; align-self: flex-end; }
    .msg.assistant { background: #dbeafe; color: #082f49; }

    /* Responsive tweaks */
    @media (max-width: 640px) {
      .chat-window { grid-template-columns: 1fr; }
      .assistant-photo { display: none; }
    }
  </style>
</head>
<body class="theme-light">
  <header class="site-header">
    <nav class="nav">
      <a class="brand" href="#hero">Jeune Boutique</a>
      <button id="darkModeToggle" aria-label="Toggle dark mode">üåó</button>
      <a class="nav-link" href="#stock">Stock</a>
      <a class="nav-link" href="#feedback">Testimonials</a>
      <a class="nav-link" href="#chatbot">Chatbot</a>
      <a class="nav-link" href="#contact">Contact</a>
    </nav>
  </header>

  <!-- Hero -->
  <section id="hero" class="hero">
    <div class="hero-media">
      <!-- We keep a video tag with a poster fallback (inline data URI). If video unsupported or not provided, poster shows. -->
      <video id="heroVideo" class="bg-video" autoplay muted loop playsinline
             poster="data:image/svg+xml;charset=UTF-8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%2360a5fa'/><stop offset='100%' stop-color='%236ee7b7'/></linearGradient></defs><rect width='100%' height='100%' fill='url(%23g)'/><text x='50%' y='50%' font-size='48' text-anchor='middle' fill='white' font-family='Arial'>Jeune Boutique</text></svg>">
        <!-- Optional: provide MP4 source inline if available. Left empty to rely on poster fallback. -->
      </video>
    </div>
    <div class="hero-content">
      <h1 class="title">Jeune Boutique</h1>
      <p class="subtitle">Digital dropshipping media boutique ‚Äî Dushorere kugiciro gito.</p>

      <div class="audio-player">
        <!-- Tiny inline audio beep (base64) to meet "audio snippet in French" with a label -->
        <audio controls preload="metadata">
          <source src="data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav" />
          <track kind="descriptions" srclang="fr" label="Snippet FR">
          Votre navigateur ne supporte pas l'audio.
        </audio>
        <p style="margin:0.4rem 0 0; font-size:0.9em; opacity:0.8;">Extrait audio FR: ‚ÄúBienvenue chez Jeune Boutique.‚Äù</p>
      </div>

      <div class="hero-cta">
        <a href="#stock" class="btn-primary">Dushorere kugiciro gito</a>
      </div>
    </div>
  </section>

  <!-- Daily Joke Spinner -->
  <section id="daily" class="daily">
    <h2>Joke y‚Äôumunsi</h2>
    <p id="dailyJoke" class="daily-text"></p>
    <button id="spinJoke" class="btn-secondary">Hindura joke</button>
  </section>

  <!-- Stock -->
  <section id="stock" class="stock">
    <h2>Ibicuruzwa biri kuri stock</h2>
    <div class="stock-controls">
      <input id="searchInput" type="text" placeholder="Shakisha: 'ndashaka amata', 'Ibinyobwa', 'munsi ya 2000'‚Ä¶" />
      <button id="searchBtn" class="btn-secondary">Shakisha</button>
    </div>

    <table class="stock-table">
      <thead>
        <tr>
          <th>Image</th>
          <th>Izina</th>
          <th>Price (Fbu)</th>
          <th>Stock</th>
          <th>Description</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="stockTableBody">
        <!-- populated via JS -->
      </tbody>
    </table>
  </section>

  <!-- Feedback -->
  <section id="feedback" class="feedback">
    <h2>Testimonials</h2>
    <div class="testimonials">
      <article class="testimonial card">
        <div class="stars" aria-label="Rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <p>‚ÄúService yihuta kandi ifise umutima. Chatbot irumva neza.‚Äù üòä</p>
        <span class="author">‚Äî Aline, Ntahangwa</span>
      </article>
      <article class="testimonial card">
        <div class="stars" aria-label="Rating">‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <p>‚ÄúIbiciro vyiza, catalogue isomeka, na WhatsApp irakora neza.‚Äù üéâ</p>
        <span class="author">‚Äî Eric, Gihosha</span>
      </article>
    </div>
  </section>

  <!-- Chatbot -->
  <section id="chatbot" class="chatbot">
    <h2>Supermarket Chatbot Assistant</h2>
    <div class="chat-top">
      <label for="profileName">Izina ryawe</label>
      <input id="profileName" type="text" placeholder="Andika izina ryawe‚Ä¶" />
      <button id="saveProfile" class="btn-secondary">Bika</button>

      <label for="toneSelect">Tone</label>
      <select id="toneSelect">
        <option value="warm">Warm</option>
        <option value="neutral">Neutral</option>
        <option value="professional">Professional</option>
      </select>
    </div>

    <div class="chat-window">
      <div id="chatMessages" class="messages" aria-live="polite"></div>
      <div class="assistant-photo" aria-hidden="true">
        <svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
          <rect width="120" height="120" rx="12" fill="#60a5fa"/>
          <circle cx="60" cy="50" r="18" fill="#fff"/>
          <rect x="30" y="76" width="60" height="24" rx="12" fill="#fff"/>
        </svg>
      </div>
    </div>

    <div class="chat-input">
      <input id="chatInput" type="text" placeholder="Andika: 'amakuru', 'ndashaka amata', 'munsi ya 2000', 'fata 3', 'fata bundle Isuku Starter', 'checkout'‚Ä¶" />
      <button id="sendBtn" class="btn-primary">Ohereza</button>
    </div>

    <div class="chat-meta">
      <p><strong>WhatsApp:</strong> <a href="https://wa.me/25771633859?text=Mwaramutse%20Jeune%20Boutique" target="_blank" rel="noopener">Support</a></p>
      <!-- Inline QR placeholder -->
      <img
        class="qr"
        alt="WhatsApp QR"
        loading="lazy"
        src="data:image/svg+xml;charset=UTF-8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'><rect width='100%' height='100%' fill='%23fff'/><rect x='8' y='8' width='112' height='112' fill='%23000'/><rect x='16' y='16' width='96' height='96' fill='%23fff'/><rect x='24' y='24' width='20' height='20' fill='%23000'/><rect x='84' y='24' width='20' height='20' fill='%23000'/><rect x='24' y='84' width='20' height='20' fill='%23000'/><rect x='48' y='48' width='32' height='32' fill='%23000'/></svg>" />
    </div>
  </section>

  <!-- Google Maps -->
  <section id="map" class="map">
    <h2>Ahantu turi</h2>
    <div class="map-embed">
      <iframe
        title="Gihosha Gisandema location"
        src="https://www.google.com/maps?q=-3.4590,29.378&z=16&output=embed"
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        allowfullscreen>
      </iframe>
    </div>
  </section>

  <!-- Contact form -->
  <section id="contact" class="contact">
    <h2>Twandikire</h2>
    <form id="contactForm" action="https://formsubmit.co/ornoirbruce5@gmail.com" method="POST" novalidate>
      <input type="hidden" name="_subject" value="Jeune Boutique Contact" />
      <input type="hidden" name="_captcha" value="false" />
      <label for="name">Izina</label>
      <input id="name" name="name" type="text" required />
      <label for="email">Email</label>
      <input id="email" name="email" type="email" required />
      <label for="message">Message</label>
      <textarea id="message" name="message" rows="4" required></textarea>
      <button type="submit" class="btn-primary">Ohereza</button>
    </form>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-grid">
      <div>
        <p>üìû +25771633859</p>
        <p>üìß ornoirbruce5@gmail.com</p>
        <p>üìç Gihosha</p>
      </div>
      <div class="socials">
        <a href="https://wa.me/25771633859" target="_blank" rel="noopener">WhatsApp</a>
        <a href="#" target="_blank" rel="noopener">Instagram</a>
        <a href="#" target="_blank" rel="noopener">Facebook</a>
      </div>
      <div class="credits">
        <p>¬© Jeune Boutique</p>
      </div>
    </div>
  </footer>

  <!-- Inline JS: products, bundles, chatbot engine, UI wiring -->
  <script>
    // products.js ‚Äî scalable catalogue with lazy-friendly structure (inline)
    const PRODUCTS = [
      { id: 1, name: "Amata Inyange 1L", category: "amata", price: 2300, stock: 24, desc: "Amata meza 1L, y‚Äôumunsi.", image: "data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='64' height='64' rx='8' fill='%2360a5fa'/><text x='50%' y='50%' font-size='10' fill='%23fff' text-anchor='middle' dy='.3em'>Amata</text></svg>" },
      { id: 2, name: "Ifarini 1kg", category: "isuku", price: 1800, stock: 40, desc: "Ifarini nziza yo mu rugo.", image: "data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='64' height='64' rx='8' fill='%236ee7b7'/><text x='50%' y='50%' font-size='10' fill='%230b1020' text-anchor='middle' dy='.3em'>Ifarini</text></svg>" },
      { id: 3, name: "Soda Cola 50cl", category: "ibinyobwa", price: 1000, stock: 60, desc: "Cola ikonje 50cl.", image: "data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='64' height='64' rx='8' fill='%23ef4444'/><text x='50%' y='50%' font-size='10' fill='%23fff' text-anchor='middle' dy='.3em'>Cola</text></svg>" },
      { id: 4, name: "Jus Ananas 1L", category: "ibinyobwa", price: 2500, stock: 15, desc: "Jus y‚ÄôAnanas, isukuye 1L.", image: "data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='64' height='64' rx='8' fill='%23f59e0b'/><text x='50%' y='50%' font-size='10' fill='%230b1020' text-anchor='middle' dy='.3em'>Ananas</text></svg>" },
      { id: 5, name: "Savon Isuku 200g", category: "isuku", price: 900, stock: 75, desc: "Isabune y‚Äôisuku yo kumesura 200g.", image: "data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='64' height='64' rx='8' fill='%2310b981'/><text x='50%' y='50%' font-size='10' fill='%230b1020' text-anchor='middle' dy='.3em'>Savon</text></svg>" }
      // ... You can expand to 100+ later; inline format stays consistent.
    ];

    const BUNDLES = [
      { name: "Isuku Starter", ids: [2,5], bundlePrice: 2500 },
      { name: "Ibinyobwa Mini", ids: [3,4], bundlePrice: 3200 }
    ];

    // chatbot.js ‚Äî assistant engine: memory, sentiment, parser, search, cart, bundles, promos (inline)
    const KEYS = {
      name: 'jb_user_name',
      prefs: 'jb_prefs',
      queries: 'jb_recent_queries',
      cart: 'jb_cart',
      sessions: 'jb_sessions_count',
      cartTotal: 'jb_cart_total'
    };

    function load(key, fallback) {
      try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
      catch { return fallback; }
    }
    function save(key, value) {
      try { localStorage.setItem(key, JSON.stringify(value)); } catch {}
    }

    const state = {
      name: load(KEYS.name, ''),
      prefs: load(KEYS.prefs, { tone: 'warm' }),
      queries: load(KEYS.queries, []),
      cart: load(KEYS.cart, []),
      sessions: load(KEYS.sessions, 0),
      cartTotal: load(KEYS.cartTotal, 0),
      lastVisit: load('jb_last_visit', null)
    };
    save(KEYS.sessions, (state.sessions || 0) + 1);
    save('jb_last_visit', Date.now());

    function toneWrap(text, tone) {
      switch (tone) {
        case 'professional': return text; // Later: trim emojis
        case 'neutral': return text;
        case 'warm': default: return text;
      }
    }

    const empathyKeys = ["ndahangayitse","ikibazo","sinzi uko","birandenze"];
    const joyKeys = ["ndishimye","ni byiza","urakoze"];

    function detectSentiment(msg) {
      const m = msg.toLowerCase();
      if (empathyKeys.some(k => m.includes(k))) return 'empathy';
      if (joyKeys.some(k => m.includes(k))) return 'joy';
      return 'neutral';
    }

    function getGreeting() {
      const name = state.name ? `, ${state.name}` : '';
      let base = `Mwaramutse${name}! Nd‚Äôindororo ya Jeune Boutique. üõí`;
      const last = state.lastVisit ? Number(state.lastVisit) : null;
      if (last) {
        const days = Math.floor((Date.now() - last) / (1000*60*60*24));
        if (days >= 3) {
          base += ` Twaragukumbuye. Dufise promo yoroheje ku bagaruka‚Äîgerageza 'checkout' urabe discount.`;
        }
      }
      return base;
    }

    function searchCatalogue(query) {
      const q = query.toLowerCase();
      let results = [];

      if (q.includes("ndashaka amata")) {
        results = PRODUCTS.filter(p =>
          p.name.toLowerCase().includes("amata") || p.category === "amata"
        );
      } else if (q.includes("ibinyobwa")) {
        results = PRODUCTS.filter(p => p.category === "ibinyobwa");
      } else if (q.includes("munsi ya")) {
        const match = q.match(/munsi ya (\d+)/);
        const limit = match ? Number(match[1]) : Infinity;
        results = PRODUCTS.filter(p => p.price < limit);
      } else {
        results = PRODUCTS.filter(p =>
          p.name.toLowerCase().includes(q) ||
          p.category.toLowerCase().includes(q)
        );
      }

      const recents = state.queries.slice(-14);
      recents.push(query);
      save(KEYS.queries, recents);
      return results;
    }

    function formatProducts(products) {
      if (!products.length) return "Nta bicuruzwa bibonetse kuri uwo mushaka.";
      return products.map(p => {
        return `- ${p.name} ‚Äî ${p.price} Fbu | Stock: ${p.stock}
  Short: ${p.desc}
  Img: ${p.image}`;
      }).join("\n");
    }

    function cartTotals() {
      let subtotal = 0;
      for (const item of state.cart) { subtotal += item.total; }
      const taxes = 0;
      const total = subtotal + taxes;
      save(KEYS.cartTotal, total);
      return { subtotal, taxes, total };
    }

    function addToCartById(id) {
      const product = PRODUCTS.find(p => p.id === id);
      if (!product) return `Id ${id} ntibonekaye.`;
      const existing = state.cart.find(i => i.id === id);
      if (existing) {
        existing.qty += 1;
        existing.total = existing.qty * product.price;
      } else {
        state.cart.push({ id, name: product.name, price: product.price, qty: 1, total: product.price });
      }
      save(KEYS.cart, state.cart);
      const t = cartTotals();
      return `Nashize: ${product.name} (1) mu igare. Subtotal: ${t.subtotal} Fbu. üõí`;
    }

    function addBundle(name) {
      const bundle = BUNDLES.find(b => b.name.toLowerCase() === name.toLowerCase());
      if (!bundle) return `Bundle '${name}' ntibonekaye.`;
      const bundleLine = {
        id: `bundle:${bundle.name}`,
        name: `Bundle ‚Äî ${bundle.name}`,
        price: bundle.bundlePrice,
        qty: 1,
        total: bundle.bundlePrice
      };
      state.cart.push(bundleLine);
      save(KEYS.cart, state.cart);
      const t = cartTotals();
      return `Nashize bundle '${bundle.name}' mu igare. Subtotal: ${t.subtotal} Fbu. üõí`;
    }

    function computeDiscount() {
      const t = cartTotals();
      const sessions = load(KEYS.sessions, 0);
      const eligible = (sessions >= 5) && (t.total >= 5000);
      if (!eligible) return { rate: 0, amount: 0 };
      const rate = Math.min(7, 5 + Math.floor((sessions - 5) / 3));
      const amount = Math.floor(t.total * (rate / 100));
      return { rate, amount };
    }

    function invoice() {
      if (!state.cart.length) return "Igare ririmo ubusa.";
      const lines = state.cart.map(i =>
        `‚Ä¢ ${i.name} x${i.qty} ‚Äî ${i.total} Fbu`
      ).join("\n");

      const { subtotal, taxes, total } = cartTotals();
      const discount = computeDiscount();
      const finalTotal = total - discount.amount;

      return `Invoice:
${lines}
Subtotal: ${subtotal} Fbu
Taxes: ${taxes} Fbu
Discount: ${discount.amount} Fbu (${discount.rate}%)
Total: ${finalTotal} Fbu

WhatsApp CTA: https://wa.me/25771633859?text=Ndipfuzwe%20na%20Invoice%20(${finalTotal}%20Fbu)
Contact form iri hepfo ku page.`;
    }

    const DAILY_JOKES = [
      "Umunsi mwiza! Ntugategereze inyota ngo unywe amazi. üå∏",
      "Ntukigere ukora shopping ufise inzara‚Äîibiribwa bose birasa neza! üòÑ",
      "Kuraho stress: tegura urutonde rw‚Äôivyo ukeneye imbere yo kuja kuri boutique. üíô",
      "Guma worohereje ubuzima: fata bundle 'Isuku Starter' utangure neza. üéâ",
      "Iseke! Uwo yaguze soda 10 ngo ntacike‚Äîyaciye yibagira ko afise frigo. üòÑ"
    ];

    function getDailyKey(date = new Date()) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `jb_daily_joke_${y}_${m}_${d}`;
    }

    function loadDailyJoke(forceNew = false) {
      const key = getDailyKey();
      if (!forceNew) {
        const stored = load(key, null);
        if (stored) return stored;
      }
      const joke = DAILY_JOKES[Math.floor(Math.random() * DAILY_JOKES.length)];
      save(key, joke);
      return joke;
    }

    function parseCommand(input) {
      const msg = input.trim();
      const m = msg.toLowerCase();

      if (m === "amakuru") {
        const joke = loadDailyJoke(false);
        return `Tip/Joke y‚Äôumunsi: ${joke}`;
      }

      if (m.startsWith("ndashaka") || m.includes("ibinyobwa") || m.includes("munsi ya")) {
        const products = searchCatalogue(m);
        return formatProducts(products);
      }

      const bundleMatch = m.match(/^fata bundle (.+)$/);
      if (bundleMatch) {
        const name = bundleMatch[1].trim();
        return addBundle(name);
      }

      const addMatch = m.match(/^fata (\d+)$/);
      if (addMatch) {
        const id = Number(addMatch[1]);
        return addToCartById(id);
      }

      if (m === "checkout") {
        return invoice();
      }

      if (m.length >= 2) {
        const products = searchCatalogue(m);
        if (products.length) return formatProducts(products);
      }

      return "Ndakubwiriza: 'amakuru', 'ndashaka amata', 'Ibinyobwa', 'munsi ya 2000', 'fata 3', 'fata bundle Isuku Starter', 'checkout'.";
    }

    async function assistantReply(userText) {
      const sentiment = detectSentiment(userText);
      const baseReply = parseCommand(userText);

      let decorated = baseReply;
      if (sentiment === 'empathy') {
        decorated = `üíô Ndumva hari ukugorwa. ${baseReply}`;
      } else if (sentiment === 'joy') {
        decorated = `üéâ Birakomeye! ${baseReply}`;
      }

      // Puter.js placeholder: local decorated reply is used.
      return toneWrap(decorated, state.prefs.tone);
    }

    const Chatbot = {
      getGreeting,
      assistantReply,
      setName(name) {
        state.name = String(name || "").slice(0, 60);
        save(KEYS.name, state.name);
      },
      setTone(tone) {
        state.prefs.tone = tone;
        save(KEYS.prefs, state.prefs);
      },
      getState() { return { ...state }; }
    };

    // ui.js ‚Äî wiring: events, rendering, toggles, animations, lazy (inline)
    const dailyP = document.getElementById('dailyJoke');
    const spinBtn = document.getElementById('spinJoke');
    const stockBody = document.getElementById('stockTableBody');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const darkToggle = document.getElementById('darkModeToggle');

    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatMessages = document.getElementById('chatMessages');

    const profileName = document.getElementById('profileName');
    const saveProfile = document.getElementById('saveProfile');
    const toneSelect = document.getElementById('toneSelect');

    function init() {
      dailyP.textContent = loadDailyJoke(false);
      spinBtn.addEventListener('click', () => {
        dailyP.textContent = loadDailyJoke(true);
        dailyP.classList.add('fade-in');
        setTimeout(() => dailyP.classList.remove('fade-in'), 520);
      });

      renderStock(PRODUCTS);

      let debounceId = null;
      searchInput.addEventListener('input', () => {
        clearTimeout(debounceId);
        debounceId = setTimeout(() => performSearch(), 220);
      });
      searchBtn.addEventListener('click', performSearch);

      darkToggle.addEventListener('click', () => {
        document.body.classList.toggle('theme-dark');
        // Optional: persist preference
        try { localStorage.setItem('jb_dark', document.body.classList.contains('theme-dark') ? '1' : '0'); } catch {}
      });
      try {
        const dm = localStorage.getItem('jb_dark');
        if (dm === '1') document.body.classList.add('theme-dark');
      } catch {}

      const initState = Chatbot.getState();
      if (initState.name) profileName.value = initState.name;
      toneSelect.value = initState.prefs?.tone || 'warm';

      saveProfile.addEventListener('click', () => {
        const name = sanitize(profileName.value);
        Chatbot.setName(name);
        pushAssistant(`Ntakara ${name}! üõí`);
      });

      toneSelect.addEventListener('change', () => {
        Chatbot.setTone(toneSelect.value);
        pushAssistant(`Tone yahindutse: ${toneSelect.value}.`);
      });

      pushAssistant(Chatbot.getGreeting());

      sendBtn.addEventListener('click', handleSend);
      chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') handleSend();
      });

      const contactForm = document.getElementById('contactForm');
      contactForm.addEventListener('submit', (e) => {
        const n = sanitize(document.getElementById('name').value);
        const em = sanitize(document.getElementById('email').value);
        const msg = sanitize(document.getElementById('message').value);
        if (!n || !em || !msg) {
          e.preventDefault();
          alert('Injiza neza izina, email, na message.');
        }
      });
    }

    function renderStock(list) {
      stockBody.innerHTML = '';
      const fragment = document.createDocumentFragment();

      list.forEach(p => {
        const tr = document.createElement('tr');
        tr.className = 'fade-in';

        const tdImg = document.createElement('td');
        const img = document.createElement('img');
        img.src = p.image;
        img.alt = sanitize(p.name);
        img.loading = 'lazy';
        tdImg.appendChild(img);

        const tdName = document.createElement('td'); tdName.textContent = p.name;
        const tdPrice = document.createElement('td'); tdPrice.textContent = String(p.price);
        const tdStock = document.createElement('td'); tdStock.textContent = String(p.stock);
        const tdDesc = document.createElement('td'); tdDesc.textContent = p.desc;

        const tdAct = document.createElement('td');
        const addBtn = document.createElement('button');
        addBtn.className = 'btn-secondary';
        addBtn.textContent = 'Fata';
        addBtn.addEventListener('click', () => sendCommand(`fata ${p.id}`));
        tdAct.appendChild(addBtn);

        tr.append(tdImg, tdName, tdPrice, tdStock, tdDesc, tdAct);
        fragment.appendChild(tr);
      });

      stockBody.appendChild(fragment);
    }

    function performSearch() {
      const q = sanitize(searchInput.value.trim());
      if (!q) { renderStock(PRODUCTS); return; }
      sendCommand(q);
    }

    function pushUser(text) {
      const div = document.createElement('div');
      div.className = 'msg user';
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function pushAssistant(text) {
      const div = document.createElement('div');
      div.className = 'msg assistant';
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function handleSend() {
      const raw = chatInput.value;
      const text = sanitize(raw);
      if (!text) return;
      pushUser(text);
      chatInput.value = '';

      const reply = await Chatbot.assistantReply(text);
      pushAssistant(reply);

      const m = text.toLowerCase();
      if (m.startsWith('ndashaka') || m.includes('ibinyobwa') || m.includes('munsi ya')) {
        const filtered = filterProducts(m);
        renderStock(filtered);
      }
    }

    function sendCommand(cmd) {
      chatInput.value = cmd;
      handleSend();
    }

    function filterProducts(m) {
      if (m.includes("ndashaka amata")) {
        return PRODUCTS.filter(p =>
          p.name.toLowerCase().includes("amata") || p.category === "amata"
        );
      } else if (m.includes("ibinyobwa")) {
        return PRODUCTS.filter(p => p.category === "ibinyobwa");
      } else if (m.includes("munsi ya")) {
        const match = m.match(/munsi ya (\d+)/);
        const limit = match ? Number(match[1]) : Infinity;
        return PRODUCTS.filter(p => p.price < limit);
      }
      return PRODUCTS.filter(p =>
        p.name.toLowerCase().includes(m) ||
        p.category.toLowerCase().includes(m)
      );
    }

    function sanitize(s) {
      return String(s || "").replace(/[<>]/g, "").slice(0, 500);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
```[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://github.com/chrisfinazzo/reverse-job-posting/tree/6ed9db4f728b2abd74583f53f3c3a4b37678da5d/src%2Fcomponents%2Fform.js?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "1")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://github.com/mykulyak/warsawjs-workshop-20-flights-search/tree/70c925ec0570478b094e881c4501c996daeb231c/src%2FSearchForm.js?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "2")
